<!doctype html>

<html lang="en">

<head>
    <!-- camera -->

    <!--
    <meta http-equiv="Content-Security-Policy" 
            content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; 
            style-src 'self' 'unsafe-inline'; 
            media-src *; 
            script-src 'self' 'unsafe-inline';
            img-src 'self' data: content:;">
-->
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">










    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, target-densitydpi=medium-dpi, user-scalable=0" />
    <title>ExciteUS</title>
    <meta name="author" content="SitePoint">

    <link rel="stylesheet" href="bebas-neue.css">

    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->

    <!-- drawer.css -->
    <link rel="stylesheet" href="drawer-master/dist/css/drawer.css">
    <!-- jquery & iScroll -->
    <script src="jquery.min.js"></script>
    <script src="iscroll.min.js"></script>
    <!-- drawer.js -->
    <script src="drawer-master/dist/js/drawer.js"></script>


    <script src="event.js" type="application/javascript"></script>
    <link rel="stylesheet" href="event.css">


    <!-- Google material design icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body class="drawer drawer--right image-overlay js">
    <div id="preloader"></div>
    <!--
    <div id="confirm-image">
        <img id="back-arrow" src="img/back-arrow.svg">
        <div id="send-image"><h7>Send image to event story's</h7></div>
        <img id="story-image" src="https://i.pinimg.com/736x/2e/79/51/2e7951e5019876bfe964810a50c65951--dinner-parties-celebrity-pictures.jpg">
<img id="story-image" src="https://images.nigms.nih.gov/PublicAssets/2484/RNA_pol_II6.jpg">
<img id="story-image" src="https://upload.wikimedia.org/wikipedia/commons/8/81/Panorama_Passo_del_Maniva_-_high_resolution.jpg">

        
    </div>
-->

    <img onclick="gohome()" id="back-arrow" class="noSelect" src="img/back-arrow.svg">
    <div id="myModal" class="modal">

        <!-- Modal content -->
        <span class="close">&times;</span>
        <div class="modal-content" id="modelinside">

            <!-- 
                <img id="story_image"src="img/story/story1.png">
-->

        </div>

    </div>
    <div class="header" id="myHeader">

    </div>
    <header role="banner">
        <button type="button" class="drawer-toggle drawer-hamburger">
            <span class="sr-only">toggle navigation</span>
            <span class="drawer-hamburger-icon"></span>
        </button>
        <nav class="drawer-nav" role="navigation">
            <ul class="drawer-menu">
                <li><a class="drawer-brand" href="#">EXCITEUS</a></li>
                <hr class="drawer-divider">
                <li><a class="drawer-menu-item" href="index.html">Overview</a></li>
                <li><a class="drawer-menu-item" href="about-the-platform.html">About the platform</a></li>
                <li><a class="drawer-menu-item" href="about-us.html">About us</a></li>

            </ul>
        </nav>
    </header>
    <main>
        <!-- The Modal -->

        <div id="events">
            <!-- 
        <div class="event-head">
            
            <img class="icon" src="img/vunzigedeuntjes.png">
            <div class="event-div">
                <h2>Event of the year</h2>
                <h3>Karement club,  oude marktstraat 21, leuven</h3>
                
            </div>
        </div>
        <section class="description-one">
            <h4>DESCRIPTION</h4>
            <h5>WANNEER: 12 mrt '18</h5>
            <h5>DUUR: 23:00 - 06:00</h5>
            <h4 class="promo">AFTER MIDNIGHT shots 1 euro</h4>
        </section>
        <section class="description-twoo">
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin in nibh iaculis, tincidunt risus ut, porta lectus. Suspendisse aliquam neque at urna condimentum hendrerit.</p>
        <img src="img/foto1">   
        </section>
-->
        </div>

        <!-- camera -->



        <div id="addstory">
            <h7>ADD STORY <i class="material-icons">camera_alt</i></h7>
        </div>

        <form id="testform" method="post">
            <input id="testinput" name="myFile" type="file">
            <input type="submit" value="Submit">
        </form>


        <!-- file upload testcode! -->
        <form id="myAwesomeForm" method="post" action="https://on-the-moment-dev.herokuapp.com/external/stories/evt-2ebd0e70-e55a-4131-8c4b-500440bfd367">
            <input type="text" id="filename" name="filename" />
            <!-- Filename -->
            <input type="submit" id="submitButton" name="submitButton" />
            <!-- Submit -->
        </form>
        <!-- file upload testcode! -->
        <script type="text/javascript" src="cordova.js"></script>
        <script>
            function gohome() {
                location.href = "index.html"
            }
            let app = {
                init: function () {
                    document.getElementById('addstory').addEventListener('click', app.takephoto);
                },
                takephoto: function () {
                    let opts = {
                        quality: 100,
                        x: 0,
                        y: 0,
                        width: window.screen.width,



                        destinationType: Camera.DestinationType.DATA_URL,
                        sourceType: Camera.PictureSourceType.CAMERA,
                        mediaType: Camera.MediaType.PICTURE,
                        encodingType: Camera.EncodingType.JPEG,
                        cameraDirection: Camera.Direction.BACK,
                        mediaType: Camera.MediaType.ALLMEDIA,
                        targetWidth: 1080,
                        targetHeight: 1920,



                    };

                    navigator.camera.getPicture(app.ftw, app.wtf, opts);


                },
                ftw: function (imageData) {
                    $('body').prepend('<div id="preloader"></div>');
                    /*document.getElementById('msg').textContent = imgURI;*/


                    /* document.getElementById('photo').src = imgURI; 
                    alert('picture taken, ready to send to server');
                    
                    */

                    var htmloutput = '<div id="confirm-image"><div id="send-image"><h7>Send image to event storys</h7></div><img id="story-image" src="data:image/jpeg;base64,' + imageData + '"></div>';
                    $('body').prepend(htmloutput);


                    setTimeout(function () {
                        $('#preloader').fadeOut('slow', function () {
                            $(this).remove();
                        });
                    }, 500);





                    $('#confirm-image').click(function () {
                        $(this).remove();
                        $('body').prepend('<p>start sending data... </p>');

                        /*  $('body').prepend('<p>' + imgURI + '</p>');*/

                        /*

                        formData = new FormData();
                        var blobfile = dataURItoBlob(imgURI);
                        console.log(imgURI);
                        console.log(blobfile);
                        formData.append('file', blobfile);


                        console.log('inputed data');
                        

                        $.ajax({
                            async: true,
                            crossDomain: true,
                            url: "https://on-the-moment-dev.herokuapp.com/external/stories/evt-2ebd0e70-e55a-4131-8c4b-500440bfd367",
                            processData: false,
                            contentType: false,
                            type: 'POST',
                            mimeType: "multipart/form-data",
                            data: formData,
                            success: function (data) {

                                $('body').prepend('<p>formdata sended</p>');


                            },
                            error: function (request, error) {


                                alert(" error: Can't do because: " + request.responseText);
                               
                            }
                        });


                        */

                        // Get the form element withot jQuery
                        var form = document.getElementById("myAwesomeForm");

                        var ImageURL = "data:image/jpeg;base64," + imageData;
                        // Split the base64 string in data and contentType
                        var block = ImageURL.split(";");
                        // Get the content type of the image
                        var contentType = block[0].split(":")[1]; // In this case "image/gif"
                        // get the real base64 content of the file
                        var realData = block[1].split(",")[1]; // In this case "R0lGODlhPQBEAPeoAJosM...."

                        // Convert it to a blob to upload
                        var blob = b64toBlob(realData, contentType);

                        // Create a FormData and append the file with "image" as parameter name
                        var formDataToUpload = new FormData(form);
                        formDataToUpload.append("file", blob);


                        $.ajax({
                            async: true,
                            crossDomain: true,
                            url: "https://on-the-moment-dev.herokuapp.com/external/stories/evt-2ebd0e70-e55a-4131-8c4b-500440bfd367",
                            data: formDataToUpload, // Add as Data the Previously create formData
                            type: "POST",
                            contentType: false,
                            processData: false,
                            cache: false,
                            mimeType: "multipart/form-data", // Change this according to your response from the server.
                            error: function (err) {
                                console.error(err);
                            },
                            success: function (data) {
                                console.log(data);
                                console.log("succesfull image sended");
                            },
                            complete: function () {
                                console.log("Request finished.");
                            }
                        });

                        /* test */



                        function b64toBlob(b64Data, contentType, sliceSize) {
                            contentType = contentType || '';
                            sliceSize = sliceSize || 512;

                            var byteCharacters = atob(b64Data);
                            var byteArrays = [];

                            for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {
                                var slice = byteCharacters.slice(offset, offset + sliceSize);

                                var byteNumbers = new Array(slice.length);
                                for (var i = 0; i < slice.length; i++) {
                                    byteNumbers[i] = slice.charCodeAt(i);
                                }

                                var byteArray = new Uint8Array(byteNumbers);

                                byteArrays.push(byteArray);
                            }

                            var blob = new Blob(byteArrays, {
                                type: contentType
                            });
                            return blob;
                        }


                        /*
                        formData = new FormData();
                        var blob = dataURItoBlob(imgURI);
                        formData.append('file', 'img/splashscreen.png');

                        $.ajax({
                            async: true,
                            crossDomain: true,
                            url: "https://on-the-moment-dev.herokuapp.com/external/stories/evt-6462ccc0-626c-4b58-b966-7b20e70d252a",
                            processData: false,
                            contentType: false,
                            type: 'POST',
                            mimeType: "multipart/form-data",
                            data: formData,
                            success: function (data) {
                                alert(data);
                                $('body').prepend('<p>data send succes</p>');


                            },
                            error: function (xhr, ajaxOptions, thrownError) {
                                alert(xhr.status);
                                alert(thrownError);
                                $('body').prepend('<p>Error sending data to server</p>');
                            }
                        });
                        */




                        /*

                        var blob = dataURItoBlob(imgURI);

                        var form = new FormData();
                        form.append("file", imgURI);

                        var settings = {
                            "async": true,
                            "crossDomain": true,
                            "url": "https://on-the-moment-dev.herokuapp.com/external/stories/evt-6462ccc0-626c-4b58-b966-7b20e70d252a",
                            "method": "POST",
                            "processData": false,
                            "contentType": false,
                            "mimeType": "multipart/form-data",
                            "data": form
                        }

                        $.ajax(settings).done(function (response) {
                            console.log(response);
                            $('body').prepend('<p>succes!</p>');
                        });

                        $.ajax(settings).error(function (request, status, error) {
                            alert(request.responseText);
                            alert(.responseText);
                            
                        });

    */



                        /* https://on-the-moment-dev.herokuapp.com/external/stories/evt-6462ccc0-626c-4b58-b966-7b20e70d252a */


                    });








                },
                wtf: function (msg) {
                    document.getElementById('msg').textContent = msg;
                }
            };

            function dataURItoBlob(dataURI) {
                // convert base64/URLEncoded data component to raw binary data held in a string
                var byteString;

                if (dataURI.split(',')[0].indexOf('base64') >= 0)
                    byteString = atob(dataURI.split(',')[1]);
                else
                    byteString = unescape(dataURI.split(',')[1]);

                // separate out the mime component
                var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

                // write the bytes of the string to a typed array
                var ia = new Uint8Array(byteString.length);

                for (var i = 0; i < byteString.length; i++) {
                    ia[i] = byteString.charCodeAt(i);
                }

                return new Blob([ia], {
                    type: mimeString
                });
            }


            document.addEventListener('deviceready', app.init);
        </script>





    </main>
</body>

</html>